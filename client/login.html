<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login – Turnier Manager</title>

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Icons -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      body {
        background: radial-gradient(circle at 0% 0%, #ef1475 0, transparent 55%),
          radial-gradient(circle at 100% 0%, #ca5818 0, transparent 55%),
          radial-gradient(circle at 100% 100%, #3b82f6 0, transparent 55%), #050816;
      }
      .glass {
        background: rgba(15, 23, 42, 0.9);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(148, 163, 184, 0.2);
      }
      .btn-gradient {
        background-image: linear-gradient(135deg, #ca5818 0%, #ef1475 50%, #6366f1 100%);
      }
    </style>
  </head>

  <body class="min-h-screen text-gray-100">
    <div class="min-h-screen flex items-center justify-center px-4 py-10">
      <div class="glass rounded-3xl w-full max-w-md p-8">
        <h2 class="text-2xl font-bold mb-6 text-center">Login</h2>

        <div
          id="loginError"
          class="hidden bg-red-900/60 border border-red-500 text-red-100 text-sm px-3 py-2 rounded mb-4"
        ></div>

        <form id="loginFormElement" class="space-y-4">
          <input
            id="loginEmail"
            type="email"
            placeholder="E-Mail"
            required
            class="w-full p-3 rounded bg-slate-800 border border-slate-600"
          />
          <input
            id="loginPassword"
            type="password"
            placeholder="Passwort"
            required
            class="w-full p-3 rounded bg-slate-800 border border-slate-600"
          />

          <button type="submit" class="btn-gradient w-full py-3 rounded font-semibold">
            Anmelden
          </button>
        </form>

        <hr class="my-6 border-slate-700" />

        <h3 class="text-lg font-semibold mb-3 text-center">Registrieren</h3>

        <div
          id="registerError"
          class="hidden bg-red-900/60 border border-red-500 text-red-100 text-sm px-3 py-2 rounded mb-4"
        ></div>

        <form id="registerFormElement" class="space-y-4">
          <input
            id="registerUsername"
            type="text"
            placeholder="Benutzername"
            required
            class="w-full p-3 rounded bg-slate-800 border border-slate-600"
          />
          <input
            id="registerEmail"
            type="email"
            placeholder="E-Mail"
            required
            class="w-full p-3 rounded bg-slate-800 border border-slate-600"
          />
          <input
            id="registerPassword"
            type="password"
            placeholder="Passwort"
            required
            class="w-full p-3 rounded bg-slate-800 border border-slate-600"
          />
          <input
            id="registerConfirmPassword"
            type="password"
            placeholder="Passwort bestätigen"
            required
            class="w-full p-3 rounded bg-slate-800 border border-slate-600"
          />

          <button type="submit" class="btn-gradient w-full py-3 rounded font-semibold">
            Registrieren
          </button>
        </form>
      </div>
    </div>

    <script>
      // ✅ RICHTIGE API-URL (lokal + prod)
      const API_BASE_URL =
        window.location.hostname === "localhost"
          ? "http://localhost:5001/api/auth"
          : "https://champsback.onrender.com/api/auth";

      // LOGIN
      document.getElementById("loginFormElement").addEventListener("submit", async (e) => {
        e.preventDefault();

        const email = loginEmail.value;
        const password = loginPassword.value;

        try {
          const res = await fetch(`${API_BASE_URL}/login`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password }),
          });

          const data = await res.json();

          if (!res.ok) throw new Error(data.message || "Login fehlgeschlagen");

          localStorage.setItem("token", data.token);
          localStorage.setItem("user", JSON.stringify(data.user));

          window.location.href = "/index.html";
        } catch (err) {
          loginError.textContent = err.message;
          loginError.classList.remove("hidden");
        }
      });

      // REGISTER
      document.getElementById("registerFormElement").addEventListener("submit", async (e) => {
        e.preventDefault();

        const username = registerUsername.value;
        const email = registerEmail.value;
        const password = registerPassword.value;
        const confirm = registerConfirmPassword.value;

        if (password !== confirm) {
          registerError.textContent = "Passwörter stimmen nicht überein";
          registerError.classList.remove("hidden");
          return;
        }

        try {
          const res = await fetch(`${API_BASE_URL}/register`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, email, password }),
          });

          const data = await res.json();

          if (!res.ok) throw new Error(data.message || "Registrierung fehlgeschlagen");

          localStorage.setItem("token", data.token);
          localStorage.setItem("user", JSON.stringify(data.user));

          window.location.href = "/index.html";
        } catch (err) {
          registerError.textContent = err.message;
          registerError.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>
